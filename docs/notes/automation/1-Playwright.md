# å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ä¹‹Playwright

::: tip å‰è¨€

ä¸ªäººè®¤ä¸ºï¼Œå¯¹äºå‰ç«¯è€Œè¨€ä¸€èˆ¬åœ¨è°ƒè¯•å¥½é¡µé¢æ¥å£ä¹‹åé€šå¸¸æ˜¯ä¸ä¼šå‡ºç°Bugçš„ï¼Œä½†æ˜¯å¾ˆå¤šBugæ˜¯ä½“ç°åœ¨å‰ç«¯çš„ã€‚

å°±é¸½ä»¬å„¿ç›®å‰æ‰€å‘†çš„å…¬å¸æ¥è¯´ï¼Œä»»ä½•é¡µé¢ä¸Šå‡ºç°çš„Bugï¼Œå¯¹äºä¸æ‡‚æŠ€æœ¯æˆ–è€…æ˜¯æƒ³ç”©é”…çš„æƒ…å†µä¸‹ï¼Œé€šå¸¸éƒ½æ˜¯å…ˆè¯´æ˜¯å‰ç«¯çš„BugğŸ˜¡ã€‚

æ­£å·§é¸½ä»¬å„¿å…¬å¸ä¸šåŠ¡æ–¹é¢æš‚æ—¶åœæ­¢äº†ï¼Œå…¬å¸è®¤ä¸ºå‰ç«¯å·¥ä½œä¸é¥±å’Œäº†ï¼Œéœ€è¦æç‚¹åˆ«çš„ä¸œè¥¿ï¼Œå°±è®©æˆ‘ä»¬å‰ç«¯çš„åŒå­¦è¿›è¡Œå‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•çš„å¼€å‘ã€‚

:::

## æ–¹æ¡ˆé€‰å‹

å¯¹äºå‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ¡ˆæœ‰å¾ˆå¤šç§ï¼ŒæŠ€æœ¯åœ¨é€‰å‹çš„æ—¶å€™ä¸ªäººæ˜¯ç›¸å¯¹æ¥è¯´ä¸€çªä¸é€šçš„ï¼Œé€šè¿‡ç¤¾åŒºå†…æœç´¢ä»¥åŠåŒäº‹æ¨èå½“æ—¶æš‚å®šäº†å‡ ä¸ªæ–¹æ¡ˆã€‚

- [Cypress](https://www.cypress.io/)
- [Playwright](https://playwright.dev/)ï¼ˆæœ€ç»ˆé€‰å‹ï¼‰
- [Selenium](https://www.selenium.dev/)
- [Robot Framework](https://robotframework.org/) ï¼ˆæµ‹è¯•åŒäº‹æ¨èï¼‰

ä¸ªäººè®¤ä¸ºè¿™äº›æ¡†æ¶çš„ä½¿ç”¨éƒ½æ˜¯å¤§å·®ä¸å·®çš„ï¼Œæ–‡æ¡£åæ¥å‡ ä¸ªéƒ½çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç°éƒ½æ˜¯çº¯è‹±æ–‡çš„ã€‚

æµ‹è¯•åŒäº‹æ¨èçš„æ˜¯ä»–ä¹‹å‰å°±ä½¿ç”¨çš„æµ‹è¯•å·¥å…·ï¼Œä½†æ˜¯æ‰“å¼€ä¹‹åçº¯è‹±çš„æ–‡æ¡£ç»™åŠé€€äº†ï¼Œå…¶æ¬¡è½¯ä»¶ä¼¼ä¹è¿è¡Œåœ¨Windowsä¸Šï¼ˆä¸ªäººä½¿ç”¨çš„Macï¼‰ï¼Œæœç´¢äº†ä¸€ä¸‹æ²¡æœ‰å‘ç°å¯¹åº”çš„è½¯ä»¶å°±æ”¾å¼ƒäº†ã€‚

## é€‰å‹ç†ç”±

å¤ªéº»çƒ¦äº†ï¼Œå¯¹æ¯”èµ·æ¥çš„è¯å„ä½è‡ªå·±æœç´¢å¼•æ“æœç´¢ä¸€ä¸‹å­å§ï¼Œè¯´ä¸€ä¸‹æœ€ç»ˆé€‰æ‹©Playwrightçš„ç†ç”±ï¼Œ

- åœ¨[Github](https://github.com/microsoft/playwright)ä¸Šé¢çœ‹äº†ä¸€ä¸‹ï¼ŒStarçš„æ•°é‡åœ¨53kå·¦å³ã€‚ç›¸å¯¹æ˜¯å‡ ä¸ªæ¡†æ¶ä¸­è¾ƒå¤šçš„ã€‚

- å…¶æ¬¡å¾®è½¯æ¨å‡ºçš„è‡ªåŠ¨åŒ–æ¡†æ¶ï¼Œä¹Ÿé›†æˆäº†VSCodeçš„è½¯ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡ç›´æ¥å®‰è£…æ’ä»¶é…åˆVSCodeæ¥ä½¿ç”¨ã€‚
- åŒæ ·ä¹Ÿæ”¯æŒå¤šæµè§ˆå™¨çš„æµ‹è¯•ï¼Œæ¯”å¦‚è°·æ­Œã€Edgeã€ç«ç‹ã€Safariæµè§ˆå™¨
- æ”¯æŒå¤šè¯­è¨€èƒ½å¤ŸåŒæ—¶ä½¿ç”¨TypeScriptã€JavaScriptã€Pythonã€.NETã€Javaï¼Œç›®å‰å…¬å¸åå°åŒå­¦æ˜¯Javaï¼Œæµ‹è¯•åŒå­¦ä¼šä¸€éƒ¨åˆ†Pythonã€‚
- æ”¯æŒå›¾å½¢åŒ–çš„æ–¹å¼æ¥ç”Ÿæˆä»£ç ï¼Œè™½ç„¶åç»­è¿˜æ˜¯éœ€è¦æ›´æ”¹çš„ä½†æ˜¯èƒ½å¤ŸèŠ‚çœå¾ˆå¤šé‡å¤çš„å·¥ä½œã€‚

## å¿«é€Ÿä¸Šæ‰‹

### å®‰è£…

å®‰è£…æ–¹å¼å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼æ¥è¿›è¡Œå®‰è£…ï¼Œåˆ›å»ºé¡¹ç›®éœ€è¦å®‰è£…[Nodejs16.x](https://nodejs.org/zh-cn)ç‰ˆæœ¬ä»¥ä¸Šï¼ˆå»ºè®®ä¸º LTS ç‰ˆæœ¬ï¼‰ï¼Œç»“åˆ[å®˜æ–¹æ–‡æ¡£](https://playwright.dev/docs/intro#installing-playwright)æ¥ä½¿ç”¨ã€‚ä¹Ÿå¯ä»¥é€šè¿‡å®‰è£…VSCodeçš„[æ’ä»¶](https://marketplace.visualstudio.com/items?itemName=ms-playwright.playwright)æ¥è¿›è¡Œä½¿ç”¨ã€‚

::: tip æç¤º

é¦–æ¬¡å®‰è£…éœ€è¦å®‰è£…æµè§ˆå™¨çš„å†…æ ¸ï¼Œå¯èƒ½é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œéœ€è¦è€å¿ƒç­‰å¾…ã€‚

:::

### VSCodeå®‰è£…

å¦‚æœä½¿ç”¨VSCodeçš„æ’ä»¶è¿›è¡Œå®‰è£…çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œã€‚

- å®‰è£…VSCodeæ’ä»¶

![image-20230731172719922](https://oss.oh-undefined.com/image-20230731172719922.png)

- Command + Shift + Pæ‰“å¼€VSCodeè½¯ä»¶çš„å‘½ä»¤é¢æ¿

![image-20230731173019960](https://oss.oh-undefined.com/image-20230731173019960.png)

- ç‚¹å‡»Testï¼šInstall Playwrightåå¼¹å‡ºé€‰æ‹©å¯¹åº”çš„æµè§ˆå™¨ï¼Œç„¶åå¯ä»¥é€‰ä¸­ä½ éœ€è¦æµ‹è¯•çš„æµè§ˆå™¨ï¼Œæˆ‘è¿™é‡Œæ˜¯é€‰æ‹©äº†å…¨éƒ¨çš„æµè§ˆå™¨ï¼Œç„¶åç‚¹å‡»ç¡®å®šç­‰å¾…å®‰è£…æˆåŠŸå³å¯ã€‚

![image-20230731173135939](https://oss.oh-undefined.com/image-20230731173135939.png)

### å‘½ä»¤è¡Œå®‰è£…

- å®‰è£… Nodejsï¼›
- åˆé€‚çš„ä½ç½®åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œä»¥è‹±æ–‡æ–¹å¼è¿›è¡Œé¡¹ç›®å‘½åï¼›
- åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹æ‰“å¼€å‘½ä»¤è¡Œçª—å£ æ‰§è¡Œå‘½ä»¤`npm init playwright@latest`å³å¯åˆå§‹åŒ–å®Œæˆã€‚

:::: code-group
::: code-group-item npm

```sh
npm init playwright@latest
```
:::

::: code-group-item yarn

```sh
yarn create playwright
```
:::

::: code-group-item pnpm

```sh
pnpm dlx create-playwright
```

:::

::::

### ç›®å½•ç»“æ„

```
â”œâ”€â”€ tests/                # æµ‹è¯•ç›®å½•
â”œâ”€â”€ playwright-report    	# æµ‹è¯•ç»“æœç»Ÿè®¡é¡µé¢
â”œâ”€â”€ test-result           # è¿è¡Œå¼‚å¸¸çš„ç»“æœã€æˆªå›¾ã€å½•å±ç­‰
â”œâ”€â”€ tests-examples        # æµ‹è¯•ç”¨ä¾‹-ç¤ºä¾‹
â”œâ”€â”€ playwright.config.ts  # é…ç½®æ–‡ä»¶
â”œâ”€â”€ package.json
```

### å¯åŠ¨

ä¿®æ”¹`package.json`æ–‡ä»¶ï¼Œåœ¨`scripts`ä¸­æ·»åŠ è¿è¡Œå‘½ä»¤`"test": "npx playwright test"`å‘½ä»¤ã€‚ç„¶åæ‰§è¡Œ`npm run test`å³å¯æ‰§è¡Œæµ‹è¯•ç¨‹åºè¿›è¡Œå…¨å±€æµ‹è¯•ã€‚

## ä¹¦å†™æ–‡æ¡£

### éƒ¨åˆ†ç”¨æ³•

```ts
page.goto(url): å¯¼èˆªåˆ°æŒ‡å®šçš„ URLã€‚

page.click(selector): ç‚¹å‡»æŒ‡å®šçš„å…ƒç´ ã€‚

page.fill(selector, value): å¡«å……æŒ‡å®šçš„è¾“å…¥å…ƒç´ ã€‚

page.textContent(selector): è·å–æŒ‡å®šå…ƒç´ çš„æ–‡æœ¬å†…å®¹ã€‚

page.waitForSelector(selector): ç­‰å¾…æŒ‡å®šçš„å…ƒç´ å‡ºç°ã€‚

page.waitForTimeout(timeout): ç­‰å¾…æŒ‡å®šçš„æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚

page.screenshot(options): å¯¹é¡µé¢è¿›è¡Œæˆªå›¾ã€‚å¯ä»¥é€šè¿‡ options å‚æ•°æ¥æŒ‡å®šæˆªå›¾çš„ç±»å‹ã€è´¨é‡ã€è·¯å¾„ç­‰ã€‚

page.evaluate(function): åœ¨é¡µé¢ä¸Šä¸‹æ–‡ä¸­æ‰§è¡ŒæŒ‡å®šçš„ JavaScript å‡½æ•°ã€‚

page.check(selector) å’Œ page.uncheck(selector): å‹¾é€‰æˆ–å–æ¶ˆå‹¾é€‰æŒ‡å®šçš„å¤é€‰æ¡†ã€‚

page.selectOption(selector, values): é€‰æ‹©æŒ‡å®šçš„ä¸‹æ‹‰èœå•é€‰é¡¹ã€‚

page.url(): è·å–å½“å‰é¡µé¢çš„ URLã€‚
```

### DEMO

```ts
test("basic test", async ({ page }) => {
  // å¯¼èˆªåˆ°æŒ‡å®šçš„ URL
  await page.goto("https://example.com");

  // ç‚¹å‡»æŒ‡å®šçš„å…ƒç´ 
  await page.click("#my-button");

  // å¡«å……æŒ‡å®šçš„è¾“å…¥å…ƒç´ 
  await page.fill("#my-input", "Hello, world!");

  // è·å–æŒ‡å®šå…ƒç´ çš„æ–‡æœ¬å†…å®¹
  const text = await page.textContent("#my-element");
  expect(text).toBe("Expected text");

  // å¯¹é¡µé¢è¿›è¡Œæˆªå›¾
  await page.screenshot({ path: "screenshot.png" });
});
```

### Playwright ç½‘ç»œè¯·æ±‚æ‹¦æˆªå’Œæ¨¡æ‹Ÿ

```ts
import { test, expect } from "@playwright/test";

test("API test", async ({ page }) => {
  // å¯ç”¨è¯·æ±‚æ‹¦æˆª
  await page.route("**/api-endpoint", (route, request) => {
    // æ£€æŸ¥è¯·æ±‚æ–¹æ³•å’Œè¯·æ±‚å¤´
    expect(request.method()).toBe("POST");
    expect(request.headers()["content-type"]).toBe("application/json");

    // æ£€æŸ¥è¯·æ±‚ä½“
    const postData = JSON.parse(request.postData());
    expect(postData.key).toBe("value");

    // è¿”å›æ¨¡æ‹Ÿçš„å“åº”
    route.fulfill({
      status: 200,
      contentType: "application/json",
      body: JSON.stringify({ key: "response value" }),
    });
  });

  // å¯¼èˆªåˆ°é¡µé¢å¹¶è§¦å‘ API è¯·æ±‚
  await page.goto("https://example.com");
});
```

å¯ä»¥é€šè¿‡ `page.route()` æ–¹æ³•æ¥æ‹¦æˆªæ‰€æœ‰æŒ‡å‘ '/api-endpoint' çš„è¯·æ±‚ã€‚æ£€æŸ¥è¯·æ±‚çš„æ–¹æ³•ã€è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ï¼Œæœ€åè¿”å›ä¸€ä¸ªæ¨¡æ‹Ÿçš„å“åº”ã€‚

### ç­‰å¾…æ¥å£å“åº”

```ts
const promise = page.waitForResponse((response) => {
   return response.url().includes("https://example.com");
});
const rsp = await promise;
const data = await rsp.json();
// åŸç†ä¸ºç­‰å¾…æ¥å£å“åº”æˆåŠŸ åˆ¤æ–­æ¥å£æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è¿”å› ä¸”æ¥å£è¿”å›å€¼ä¸º1 å¦‚æœä¸ä¸º1åˆ™å¤±è´¥
if (data.rspCode != 1) {
  throw Error("åˆ›å»ºå‘˜å·¥å¤±è´¥");
}
```

